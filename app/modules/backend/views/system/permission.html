<div>
    <div class="permission">
        {% if role_id %}<form ng-submit="editapp()">{% endif %}
            <label style="display: inline-block;height: 30px;line-height: 30px;font-size: 18px;padding: 0 4px;background: #00a4ff;color:#fff;box-sizing: border-box"><input
                    type="checkbox" id="all"> 全选 </label><span onclick="add(0)"> 添加控制器</span>
            <div class="controller" style="background: #00A0E4;color: #fff" ng-repeat="controllers in list">
                <label  style="display: inline-block;height: 30px;line-height: 30px;font-size: 18px;margin: 0 4px"><input name="app" type="checkbox" value="{_ controllers.id _}"  ng-if="controllers.checked"  checked /> <input name="app" type="checkbox" value="{_ controllers.id _}"  ng-if="!controllers.checked"   />{_ controllers.remark _}</label><span>添加方法</span>
            <div class="action">
                <label style="display: inline-block;height: 30px;line-height: 30px;margin: 0 10px" ng-repeat="actions in controllers.child"><input name="app" type="checkbox" value="{_ actions.id _}"  ng-if="actions.checked"  checked /> <input name="app" type="checkbox" value="{_ actions.id _}"  ng-if="!actions.checked"   /> {_ actions.remark _}</label>
            </div>
            <br/>

            </div>
             {% if role_id %} <input type="submit"  style="width: 150px;height: 30px;border-radius: 10px;background: #00a4ff;color:#fff;font-size: 18px;cursor: pointer;text-align: center"  value="确 &nbsp; &nbsp; &nbsp; &nbsp;   定"/>{% endif %}
            {% if role_id %}</form>{% endif %}
    </div>

    <div class="add">
        <form name="addForm">
            <table>
                <caption>添 加 应 用</caption>
                <tr>
                    <th>名称(英文)</th>
                    <td><input class="biginput" ng-model="add.name" name="name" required ng-minlength="2" maxlength="10"
                               ng-class="{'error':addForm.name.$invalid}"/></td>
                </tr>
                <tr>
                    <th>描述(中文)</th>
                    <td><input class="biginput" ng-model="add.remark" name="remark" required ng-minlength="2"
                               maxlength="10" ng-class="{'error':addForm.remark.$invalid}">
                    </td>
                </tr>
                <tr>
                    <th>是否显示</th>
                    <td><input type="radio" ng-model="add.show" value="1" name="show" checked/> 是 &nbsp;&nbsp;<input
                            type="radio" ng-model="add.show" value="0" name="show"/> 否
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input type="hidden" name="pid" ng-model="add.pid">
                        <input type="submit" class="bigbutton" value=" 确 定 " ng-disabled="addForm.$invalid"
                               ng-click="addsub()"/>
                    </td>
                </tr>
            </table>
        </form>
    </div>

</div>
<script>
    $("#all").click(function () {
        if ($(this).is(':checked')) {
            $(".permission").find("input:checkbox").prop("checked", true);
        } else {
            $(".permission").find("input:checkbox").prop("checked", false);
        }
    })
    $(".controller input:checkbox").click(function () {
        if ($(this).is(':checked')) {
            $(this).parents('.controller').next('.action').find("input:checkbox").prop("checked", true);
        } else {
            $(this).parents('.controller').next('.action').find("input:checkbox").prop("checked", false);
        }
    })
    $(".action input:checkbox").click(function () {
        if ($(this).is(':checked')) {
            $(this).parents('.action').prev('.controller').find("input:checkbox").prop("checked", true);
        }
    })

    function add(id) {
        $(".add form")[0].reset();
        $(".add input[name=pid]").val(id);
        $(".add").show();
    }
    myapp.controller('myCtrl', ['$scope', '$http', 'retrieve', function ($scope, $http, retrieve) {
        $scope.info = {};
        $scope.edit = {};
        retrieve.list($scope);
        $scope.addsub = function () {
            $scope.edit.pid = $(".add input[name=pid]").val();
            $scope.edit.action = 'add';
            retrieve.edit($scope.add, '/backend/system/appedit');
        }

        $scope.editapp = function () {
            $scope.info.app = [];
            $scope.info.action = 'edit';
            $("input[name=app]").each(function (i, o) {
                if ($(o).is(":checked")) {
                    $scope.info.app.push($(o).val());
                }
            })
            console.log($scope.info);
            retrieve.edit($scope.info, '');
        }


    }])
</script>